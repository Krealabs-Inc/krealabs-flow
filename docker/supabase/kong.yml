_format_version: "1.1"

###############################################################################
# Dev setup — no key-auth required (local network only).
# Studio authenticates to PostgREST via JWT in Authorization header;
# PostgREST validates the token against PGRST_JWT_SECRET directly.
###############################################################################
services:

  # --------------------------------------------------------------------------
  # GoTrue — /auth/v1/
  # --------------------------------------------------------------------------
  - name: auth-v1
    url: http://supabase-auth:9999/
    routes:
      - name: auth-v1
        strip_path: true
        paths:
          - /auth/v1/
    plugins:
      - name: cors

  # --------------------------------------------------------------------------
  # PostgREST — /rest/v1/
  # Studio sends Authorization: Bearer <jwt>, PostgREST validates it itself.
  # --------------------------------------------------------------------------
  - name: rest-v1
    url: http://supabase-rest:3000/
    routes:
      - name: rest-v1
        strip_path: true
        paths:
          - /rest/v1/
    plugins:
      - name: cors

  # --------------------------------------------------------------------------
  # postgres-meta — /pg/
  # Used by Studio for schema browser, SQL editor, table management.
  # --------------------------------------------------------------------------
  - name: meta
    url: http://supabase-meta:8080/
    routes:
      - name: meta-all
        strip_path: true
        paths:
          - /pg/
    plugins:
      - name: cors
